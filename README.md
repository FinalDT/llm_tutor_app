
### 구현하고자 하는 LLM기능
- 1단계 : 진단테스트 본 학습자에게 맞춤형 분석데이터 제공
- 2단계 : 각 진단테스트에서 틀린 문항 기준?으로 해설해주면서 유사문항 추천
- 3단계 : 유사문항 추천 후 학습자가 문제풀 때 힌트유도(정답 바로 공개금지)
---

### 현재 상태 - 테스트 하는법

- Azure portal의 1dt-final-llm 이라는 function 리소스를 찾아 그 안의 tutor_api 앱 클릭
- 콘솔 상단의 Get function url 클릭하여 master hostkey를 복사
- Postman 을 열고 POST 탭을 지정하여 복사한 hostkey를 입력
- body탭 - RAW탭 클릭하고 형식을 JSON으로 지정

### 1단계
- gold.vw_personal_item_enriched 테이블의 같은 행에 있는 learnerID와 session_id 정보를 입력

```
{
  "request_type": "session_summary",
  "learnerID": "A070001768",
  "session_id": "rt-20250918:first6:A070001768:0"
}
```

- 결과가 잘 나오는지 테스트. 다음 결과는 테스트했을 시 출력문.
```
{
    "feedback": ""진단 테스트 푸느라 수고 많았어! 결과를 알려줄게.\n\n전체 6 문제 중에서 2 문제를 맞혔네. 정말 잘했어! 👍\n\n이번 테스트에서는 아쉽게도 1, 2, 4, 5 번 문제를 틀렸더라. 데이터를 분석해보니, 주로 \"부채꼴의 호의 길이와 넓이 사이의 관계, 다각형의 내각의 크기의 합, 원뿔의 겉넓이, 각기둥의 겉넓이\" 개념들이 조금 헷갈리는 것 같아.\n\n우리 같이 \"부채꼴의 호의 길이와 넓이 사이의 관계\"에 대한 학습을 시작해볼까?"
}
--- 이 부분이 conversation_history로 들어간다.
```

### 2단계
- 진단테스트 결과를 얻어냈으니 몇번 문항을 틀렸는지 학생이 알 수 있음.
- 틀린 문항 번호를 입력하여 유사문항 추천해 달라고 입력

```
{
  "request_type": "item_feedback",
  "learnerID": "A070001768",
  "session_id": "rt-20250918:first6:A070001768:0",
  "message": "1번문제 유사 문항 주세요",
  "conversation_history": [
    {
      "role": "user",
      "content": "피드백 요청"
    },
    {
      "role": "assistant",
      "content": "진단 테스트 푸느라 수고 많았어! 결과를 알려줄게.\n\n전체 6 문제 중에서 2 문제를 맞혔네. 정말 잘했어! 👍\n\n이번 테스트에서는 아쉽게도 1, 2, 4, 5 번 문제를 틀렸더라. 데이터를 분석해보니, 주로 \"부채꼴의 호의 길이와 넓이 사이의 관계, 다각형의 내각의 크기의 합, 원뿔의 겉넓이, 각기둥의 겉넓이\" 개념들이 조금 헷갈리는 것 같아.\n\n우리 같이 \"부채꼴의 호의 길이와 넓이 사이의 관계\"에 대한 학습을 시작해볼까?"
    }
  ]
}

```

- 결과가 잘 나오는지 테스트

```
{
    "feedback": "좋아! '각기둥의 겉넓이' 개념을 더 연습해볼까? 아래 문제를 풀어봐.\n\n높이가 5cm, 밑면이 정사각형인 각기둥의 겉넓이를 구하세요. 정사각형의 한 변의 길이는 4cm입니다.",
    "generated_question_data": {
        "new_question_text": "높이가 5cm, 밑면이 정사각형인 각기둥의 겉넓이를 구하세요. 정사각형의 한 변의 길이는 4cm입니다.",
        "correct_answer": "72 cm²",
        "explanation": "각기둥의 겉넓이는 밑면의 넓이와 옆면의 넓이를 모두 더하여 구합니다. 밑면은 정사각형이므로 넓이는 4cm x 4cm = 16cm²입니다. 각기둥의 옆면은 4개의 직사각형이며, 각 직사각형의 넓이는 높이 x 한 변의 길이입니다. 즉, 5cm x 4cm = 20cm²입니다. 4개의 옆면을 더하면 20cm² x 4 = 80cm²입니다. 따라서 겉넓이는 16cm² + 80cm² = 96cm²입니다."
    },
    "conversation_history": [
        {
            "role": "user",
            "content": "피드백 요청"
        },
        {
            "role": "assistant",
            "content": "진단 테스트 푸느라 수고 많았어! 결과를 알려줄게.\n\n전체 6 문제 중에서 2 문제를 맞혔네. 정말 잘했어! 👍\n\n이번 테스트에서는 아쉽게도 1, 2, 4, 5 번 문제를 틀렸더라. 데이터를 분석해보니, 주로 \"부채꼴의 호의 길이와 넓이 사이의 관계, 다각형의 내각의 크기의 합, 원뿔의 겉넓이, 각기둥의 겉넓이\" 개념들이 조금 헷갈리는 것 같아.\n\n우리 같이 \"부채꼴의 호의 길이와 넓이 사이의 관계\"에 대한 학습을 시작해볼까?"
        },
        {
            "role": "user",
            "content": "1번문제 유사 문항 주세요"
        },
        {
            "role": "assistant",
            "content": "좋아! '각기둥의 겉넓이' 개념을 더 연습해볼까? 아래 문제를 풀어봐.\n\n높이가 5cm, 밑면이 정사각형인 각기둥의 겉넓이를 구하세요. 정사각형의 한 변의 길이는 4cm입니다."
        }
    ]
}

```


## 3단계, 학생이 정답을 입력했을때 채점하는 단계

```
{
  "request_type": "check_generated_answer",
  "learnerID": "A070001768",
  "student_answer": "75",
  "generated_question_data": {
    "new_question_text": "높이가 5cm, 밑면이 정사각형인 각기둥의 겉넓이를 구하세요. 정사각형의 한 변의 길이는 4cm입니다.",
    "correct_answer": "72 cm²",
    "explanation": "각기둥의 겉넓이는 밑면의 넓이와 옆면의 넓이를 모두 더하여 구합니다. 밑면은 정사각형이므로 넓이는 4cm x 4cm = 16cm²입니다. 각기둥의 옆면은 4개의 직사각형이며, 각 직사각형의 넓이는 높이 x 한 변의 길이입니다. 즉, 5cm x 4cm = 20cm²입니다. 4개의 옆면을 더하면 20cm² x 4 = 80cm²입니다. 따라서 겉넓이는 16cm² + 80cm² = 96cm²입니다."
  },
  "conversation_history": [
    {
      "role": "user",
      "content": "피드백 요청"
    },
    {
      "role": "assistant",
      "content": "진단 테스트 푸느라 수고 많았어! 결과를 알려줄게.\n\n전체 6 문제 중에서 2 문제를 맞혔네. 정말 잘했어! 👍\n\n이번 테스트에서는 아쉽게도 1, 2, 4, 5 번 문제를 틀렸더라. 데이터를 분석해보니, 주로 \"부채꼴의 호의 길이와 넓이 사이의 관계, 다각형의 내각의 크기의 합, 원뿔의 겉넓이, 각기둥의 겉넓이\" 개념들이 조금 헷갈리는 것 같아.\n\n우리 같이 \"부채꼴의 호의 길이와 넓이 사이의 관계\"에 대한 학습을 시작해볼까?"
    },
    {
      "role": "user",
      "content": "1번문제 유사 문항 주세요"
    },
    {
      "role": "assistant",
      "content": "좋아! '각기둥의 겉넓이' 개념을 더 연습해볼까? 아래 문제를 풀어봐.\n\n높이가 5cm, 밑면이 정사각형인 각기둥의 겉넓이를 구하세요. 정사각형의 한 변의 길이는 4cm입니다."
    }
  ]
}

```

- 결과가 잘 나오는지 테스트
  
```
{
    "feedback": "아쉽지만 틀렸어. 정답은 '72 cm²'이야.\n\n자세한 해설은 다음과 같아:\n각기둥의 겉넓이는 밑면의 넓이와 옆면의 넓이를 모두 더하여 구합니다. 밑면은 정사각형이므로 넓이는 4cm x 4cm = 16cm²입니다. 각기둥의 옆면은 4개의 직사각형이며, 각 직사각형의 넓이는 높이 x 한 변의 길이입니다. 즉, 5cm x 4cm = 20cm²입니다. 4개의 옆면을 더하면 20cm² x 4 = 80cm²입니다. 따라서 겉넓이는 16cm² + 80cm² = 96cm²입니다.",
    "conversation_history": [
        {
            "role": "user",
            "content": "피드백 요청"
        },
        {
            "role": "assistant",
            "content": "진단 테스트 푸느라 수고 많았어! 결과를 알려줄게.\n\n전체 6 문제 중에서 2 문제를 맞혔네. 정말 잘했어! 👍\n\n이번 테스트에서는 아쉽게도 1, 2, 4, 5 번 문제를 틀렸더라. 데이터를 분석해보니, 주로 \"부채꼴의 호의 길이와 넓이 사이의 관계, 다각형의 내각의 크기의 합, 원뿔의 겉넓이, 각기둥의 겉넓이\" 개념들이 조금 헷갈리는 것 같아.\n\n우리 같이 \"부채꼴의 호의 길이와 넓이 사이의 관계\"에 대한 학습을 시작해볼까?"
        },
        {
            "role": "user",
            "content": "1번문제 유사 문항 주세요"
        },
        {
            "role": "assistant",
            "content": "좋아! '각기둥의 겉넓이' 개념을 더 연습해볼까? 아래 문제를 풀어봐.\n\n높이가 5cm, 밑면이 정사각형인 각기둥의 겉넓이를 구하세요. 정사각형의 한 변의 길이는 4cm입니다."
        },
        {
            "role": "user",
            "content": "내 답은 75이야."
        },
        {
            "role": "assistant",
            "content": "아쉽지만 틀렸어. 정답은 '72 cm²'이야.\n\n자세한 해설은 다음과 같아:\n각기둥의 겉넓이는 밑면의 넓이와 옆면의 넓이를 모두 더하여 구합니다. 밑면은 정사각형이므로 넓이는 4cm x 4cm = 16cm²입니다. 각기둥의 옆면은 4개의 직사각형이며, 각 직사각형의 넓이는 높이 x 한 변의 길이입니다. 즉, 5cm x 4cm = 20cm²입니다. 4개의 옆면을 더하면 20cm² x 4 = 80cm²입니다. 따라서 겉넓이는 16cm² + 80cm² = 96cm²입니다."
        }
    ]
}

```

- 현재 구현된 단계는 이 부분까지. 힌트제공 부분은 추가 테스트 필요
- 정답 직접 알려주지 않는 부분을 구현할 경우 프롬프트를 추가 입력할 필요.


