openapi: 3.0.3
info:
  title: LLM Tutor API
  description: |
    **AI ê¸°ë°˜ ê°œì¸í™” ìˆ˜í•™ íŠœí„°ë§ ì‹œìŠ¤í…œ**

    ì´ APIëŠ” 3ë‹¨ê³„ í•™ìŠµ í”Œë¡œìš°ë¥¼ ì œê³µí•©ë‹ˆë‹¤:
    1. **ì§„ë‹¨í…ŒìŠ¤íŠ¸ ë¶„ì„** - í•™ìŠµìì˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„ ë° ì•½í•œ ê°œë… íŒŒì•…
    2. **ìœ ì‚¬ë¬¸í•­ ìƒì„±** - AIê°€ ê°œì¸ ìˆ˜ì¤€ì— ë§ëŠ” ìƒˆë¡œìš´ ì—°ìŠµ ë¬¸ì œ ìƒì„±
    3. **ì†Œí¬ë¼í‹± íŒíŠ¸** - ì •ë‹µì„ ì§ì ‘ ì•Œë ¤ì£¼ì§€ ì•Šê³  ì§ˆë¬¸ì„ í†µí•œ í•™ìŠµ ìœ ë„

    ## ì£¼ìš” íŠ¹ì§•
    - ğŸ¤– **íŒŒì¸íŠœë‹ëœ GPT-4o-mini**: 45ê°œ ì‹¤ì œ DB íŒ¨í„´ìœ¼ë¡œ í•™ìŠµëœ ì „ìš© ëª¨ë¸
    - ğŸ“Š **ê°œì¸í™” í•™ìŠµ**: ì‹¤ì œ í•™ìŠµ ë°ì´í„° ê¸°ë°˜ ë§ì¶¤í˜• ë¬¸ì œ ìƒì„±
    - ğŸ¯ **ì†Œí¬ë¼í‹± ë°©ì‹**: ì •ë‹µ ì§ì ‘ ì œê³µ ì—†ì´ ìŠ¤ìŠ¤ë¡œ ê¹¨ë‹«ë„ë¡ ìœ ë„
    - ğŸ’¬ **ëŒ€í™”í˜• ì¸í„°í˜ì´ìŠ¤**: ì—°ì†ì ì¸ ìƒí˜¸ì‘ìš©ìœ¼ë¡œ í•™ìŠµ íš¨ê³¼ ê·¹ëŒ€í™”

    ## ê¸°ìˆ  ìŠ¤íƒ
    - **Backend**: Azure Functions (Python 3.9+)
    - **AI Model**: OpenAI GPT-4o-mini-2024-07-18-minimal-tutor (Fine-tuned)
    - **Database**: SQL Server
    - **Authentication**: Function Level (ìë™ ì²˜ë¦¬)
  version: 1.0.0
  contact:
    name: LLM Tutor Development Team
    url: https://github.com/your-repo/llm-tutor
    email: dev@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:7071/api
    description: ë¡œì»¬ ê°œë°œ ì„œë²„
  - url: https://your-azure-function.azurewebsites.net/api
    description: ìš´ì˜ ì„œë²„

paths:
  /tutor_api:
    post:
      summary: LLM íŠœí„° API ë©”ì¸ ì—”ë“œí¬ì¸íŠ¸
      description: |
        ëª¨ë“  íŠœí„°ë§ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•˜ëŠ” í†µí•© ì—”ë“œí¬ì¸íŠ¸ì…ë‹ˆë‹¤.
        request_type í•„ë“œì— ë”°ë¼ ë‹¤ë¥¸ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

        - `session_summary`: ì§„ë‹¨í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„ (1ë‹¨ê³„)
        - `item_feedback`: ìœ ì‚¬ë¬¸í•­ ìƒì„± (2ë‹¨ê³„)
        - `generated_item`: íŒíŠ¸ ì œê³µ (3ë‹¨ê³„)
      operationId: tutorAPI
      tags:
        - Tutoring
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/SessionSummaryRequest'
                - $ref: '#/components/schemas/ItemFeedbackRequest'
                - $ref: '#/components/schemas/GeneratedItemRequest'
              discriminator:
                propertyName: request_type
                mapping:
                  session_summary: '#/components/schemas/SessionSummaryRequest'
                  item_feedback: '#/components/schemas/ItemFeedbackRequest'
                  generated_item: '#/components/schemas/GeneratedItemRequest'
            examples:
              session_summary:
                summary: 1ë‹¨ê³„ - ì§„ë‹¨í…ŒìŠ¤íŠ¸ ë¶„ì„
                description: í•™ìŠµìì˜ ì§„ë‹¨í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ ì•½í•œ ê°œë…ì„ íŒŒì•…í•©ë‹ˆë‹¤.
                value:
                  request_type: "session_summary"
                  learnerID: "A070001768"
                  session_id: "rt-20250918:first6:A070001768:0"
                  conversation_history: []
              item_feedback:
                summary: 2ë‹¨ê³„ - ìœ ì‚¬ë¬¸í•­ ìƒì„±
                description: í‹€ë¦° ë¬¸ì œì— ëŒ€í•œ ìœ ì‚¬ ë¬¸í•­ì„ AIê°€ ìƒì„±í•©ë‹ˆë‹¤.
                value:
                  request_type: "item_feedback"
                  learnerID: "A070001768"
                  session_id: "rt-20250918:first6:A070001768:0"
                  message: "1ë²ˆë¬¸ì œ ìœ ì‚¬ ë¬¸í•­ ì£¼ì„¸ìš”"
                  conversation_history:
                    - role: "user"
                      content: "í”¼ë“œë°± ìš”ì²­"
                    - role: "assistant"
                      content: "ì§„ë‹¨ í…ŒìŠ¤íŠ¸ í‘¸ëŠë¼ ìˆ˜ê³  ë§ì•˜ì–´! ê²°ê³¼ë¥¼ ì•Œë ¤ì¤„ê²Œ..."
              generated_item:
                summary: 3ë‹¨ê³„ - íŒíŠ¸ ì œê³µ
                description: ìƒì„±ëœ ë¬¸í•­ì— ëŒ€í•´ ì†Œí¬ë¼í‹± ë°©ì‹ì˜ íŒíŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
                value:
                  request_type: "generated_item"
                  generated_question_data:
                    new_question_text: "ë†’ì´ê°€ 5cm, ë°‘ë©´ì´ ì •ì‚¬ê°í˜•ì¸ ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´ë¥¼ êµ¬í•˜ì„¸ìš”. ì •ì‚¬ê°í˜•ì˜ í•œ ë³€ì˜ ê¸¸ì´ëŠ” 4cmì…ë‹ˆë‹¤."
                    correct_answer: "72 cmÂ²"
                    explanation: "ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´ëŠ” ë°‘ë©´ì˜ ë„“ì´ì™€ ì˜†ë©´ì˜ ë„“ì´ë¥¼ ëª¨ë‘ ë”í•˜ì—¬ êµ¬í•©ë‹ˆë‹¤..."
                  message: "ëª¨ë¥´ê² ì–´ìš”"
                  conversation_history:
                    - role: "user"
                      content: "1ë²ˆë¬¸ì œ ìœ ì‚¬ ë¬¸í•­ ì£¼ì„¸ìš”"
                    - role: "assistant"
                      content: "ì¢‹ì•„! 'ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´' ê°œë…ì„ ë” ì—°ìŠµí•´ë³¼ê¹Œ?"
                  learnerID: "A070001768"
                  original_concept: "ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´"
      responses:
        '200':
          description: ì„±ê³µì ì¸ ì‘ë‹µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TutorAPIResponse'
              examples:
                session_summary_response:
                  summary: ì§„ë‹¨í…ŒìŠ¤íŠ¸ ë¶„ì„ ì‘ë‹µ
                  value:
                    feedback: "ì§„ë‹¨ í…ŒìŠ¤íŠ¸ í‘¸ëŠë¼ ìˆ˜ê³  ë§ì•˜ì–´! ê²°ê³¼ë¥¼ ì•Œë ¤ì¤„ê²Œ.\n\nì „ì²´ 6 ë¬¸ì œ ì¤‘ì—ì„œ 2 ë¬¸ì œë¥¼ ë§í˜”ë„¤. ì •ë§ ì˜í–ˆì–´! ğŸ‘\n\nì´ë²ˆ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì•„ì‰½ê²Œë„ 1, 2, 4, 5 ë²ˆ ë¬¸ì œë¥¼ í‹€ë ¸ë”ë¼. ë°ì´í„°ë¥¼ ë¶„ì„í•´ë³´ë‹ˆ, ì£¼ë¡œ \"ë¶€ì±„ê¼´ì˜ í˜¸ì˜ ê¸¸ì´ì™€ ë„“ì´ ì‚¬ì´ì˜ ê´€ê³„, ë‹¤ê°í˜•ì˜ ë‚´ê°ì˜ í¬ê¸°ì˜ í•©, ì›ë¿”ì˜ ê²‰ë„“ì´, ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´\" ê°œë…ë“¤ì´ ì¡°ê¸ˆ í—·ê°ˆë¦¬ëŠ” ê²ƒ ê°™ì•„.\n\nìš°ë¦¬ ê°™ì´ \"ë¶€ì±„ê¼´ì˜ í˜¸ì˜ ê¸¸ì´ì™€ ë„“ì´ ì‚¬ì´ì˜ ê´€ê³„\"ì— ëŒ€í•œ í•™ìŠµì„ ì‹œì‘í•´ë³¼ê¹Œ?"
                    conversation_history:
                      - role: "user"
                        content: "í”¼ë“œë°± ìš”ì²­"
                      - role: "assistant"
                        content: "ì§„ë‹¨ í…ŒìŠ¤íŠ¸ í‘¸ëŠë¼ ìˆ˜ê³  ë§ì•˜ì–´! ê²°ê³¼ë¥¼ ì•Œë ¤ì¤„ê²Œ..."
                item_feedback_response:
                  summary: ìœ ì‚¬ë¬¸í•­ ìƒì„± ì‘ë‹µ
                  value:
                    feedback: "ì¢‹ì•„! 'ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´' ê°œë…ì„ ë” ì—°ìŠµí•´ë³¼ê¹Œ? ì•„ë˜ ë¬¸ì œë¥¼ í’€ì–´ë´.\n\në†’ì´ê°€ 5cm, ë°‘ë©´ì´ ì •ì‚¬ê°í˜•ì¸ ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´ë¥¼ êµ¬í•˜ì„¸ìš”. ì •ì‚¬ê°í˜•ì˜ í•œ ë³€ì˜ ê¸¸ì´ëŠ” 4cmì…ë‹ˆë‹¤."
                    conversation_history:
                      - role: "user"
                        content: "1ë²ˆë¬¸ì œ ìœ ì‚¬ ë¬¸í•­ ì£¼ì„¸ìš”"
                      - role: "assistant"
                        content: "ì¢‹ì•„! 'ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´' ê°œë…ì„ ë” ì—°ìŠµí•´ë³¼ê¹Œ?"
                    generated_question_data:
                      new_question_text: "ë†’ì´ê°€ 5cm, ë°‘ë©´ì´ ì •ì‚¬ê°í˜•ì¸ ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´ë¥¼ êµ¬í•˜ì„¸ìš”. ì •ì‚¬ê°í˜•ì˜ í•œ ë³€ì˜ ê¸¸ì´ëŠ” 4cmì…ë‹ˆë‹¤."
                      correct_answer: "72 cmÂ²"
                      explanation: "ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´ëŠ” ë°‘ë©´ì˜ ë„“ì´ì™€ ì˜†ë©´ì˜ ë„“ì´ë¥¼ ëª¨ë‘ ë”í•˜ì—¬ êµ¬í•©ë‹ˆë‹¤..."
                generated_item_response:
                  summary: íŒíŠ¸ ì œê³µ ì‘ë‹µ
                  value:
                    feedback: "ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´ë¥¼ êµ¬í•˜ë ¤ë©´ ì–´ë–¤ ë©´ë“¤ì˜ ë„“ì´ë¥¼ ë”í•´ì•¼ í• ê¹Œìš”?"
                    conversation_history:
                      - role: "user"
                        content: "ëª¨ë¥´ê² ì–´ìš”"
                      - role: "assistant"
                        content: "ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´ë¥¼ êµ¬í•˜ë ¤ë©´ ì–´ë–¤ ë©´ë“¤ì˜ ë„“ì´ë¥¼ ë”í•´ì•¼ í• ê¹Œìš”?"
        '400':
          description: ì˜ëª»ëœ ìš”ì²­ (Bad Request)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_required_field:
                  summary: í•„ìˆ˜ í•„ë“œ ëˆ„ë½
                  value:
                    error: "Required fields are missing: learnerID"
                invalid_request_type:
                  summary: ì˜ëª»ëœ ìš”ì²­ íƒ€ì…
                  value:
                    error: "Invalid request_type."
        '500':
          description: ë‚´ë¶€ ì„œë²„ ì˜¤ë¥˜ (Internal Server Error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                server_error:
                  summary: ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜
                  value:
                    error: "Database connection failed"
                llm_error:
                  summary: AI ëª¨ë¸ ì˜¤ë¥˜
                  value:
                    error: "LLM call failed: API rate limit exceeded"

components:
  schemas:
    # ê¸°ë³¸ ë©”ì‹œì§€ êµ¬ì¡°
    ConversationMessage:
      type: object
      required:
        - role
        - content
      properties:
        role:
          type: string
          enum: [user, assistant, system]
          description: ë©”ì‹œì§€ ë°œì‹ ì ì—­í• 
          example: "user"
        content:
          type: string
          description: ë©”ì‹œì§€ ë‚´ìš©
          example: "íŒíŠ¸ ì£¼ì„¸ìš”"
          minLength: 1
          maxLength: 10000

    # ìƒì„±ëœ ë¬¸í•­ ë°ì´í„°
    GeneratedQuestion:
      type: object
      required:
        - new_question_text
        - correct_answer
        - explanation
      properties:
        new_question_text:
          type: string
          description: AIê°€ ìƒì„±í•œ ìƒˆë¡œìš´ ë¬¸ì œ í…ìŠ¤íŠ¸
          example: "ë†’ì´ê°€ 5cm, ë°‘ë©´ì´ ì •ì‚¬ê°í˜•ì¸ ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´ë¥¼ êµ¬í•˜ì„¸ìš”. ì •ì‚¬ê°í˜•ì˜ í•œ ë³€ì˜ ê¸¸ì´ëŠ” 4cmì…ë‹ˆë‹¤."
          minLength: 10
          maxLength: 2000
        correct_answer:
          type: string
          description: ìƒì„±ëœ ë¬¸ì œì˜ ì •ë‹µ
          example: "72 cmÂ²"
          minLength: 1
          maxLength: 200
        explanation:
          type: string
          description: ë¬¸ì œ í•´ì„¤ ë° í’€ì´ ê³¼ì •
          example: "ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´ëŠ” ë°‘ë©´ì˜ ë„“ì´ì™€ ì˜†ë©´ì˜ ë„“ì´ë¥¼ ëª¨ë‘ ë”í•˜ì—¬ êµ¬í•©ë‹ˆë‹¤..."
          minLength: 10
          maxLength: 2000

    # 1ë‹¨ê³„: ì§„ë‹¨í…ŒìŠ¤íŠ¸ ìš”ì•½ ìš”ì²­
    SessionSummaryRequest:
      type: object
      required:
        - request_type
        - learnerID
        - session_id
      properties:
        request_type:
          type: string
          enum: [session_summary]
          description: ìš”ì²­ íƒ€ì… (ì§„ë‹¨í…ŒìŠ¤íŠ¸ ìš”ì•½)
          example: "session_summary"
        learnerID:
          type: string
          description: í•™ìŠµì ê³ ìœ  ID
          example: "A070001768"
          pattern: '^[A-Z][0-9]{9}$'
        session_id:
          type: string
          description: ì§„ë‹¨í…ŒìŠ¤íŠ¸ ì„¸ì…˜ ID
          example: "rt-20250918:first6:A070001768:0"
          minLength: 5
          maxLength: 100
        conversation_history:
          type: array
          items:
            $ref: '#/components/schemas/ConversationMessage'
          description: ì´ì „ ëŒ€í™” ê¸°ë¡ (ì„ íƒì )
          default: []
          maxItems: 100

    # 2ë‹¨ê³„: ìœ ì‚¬ë¬¸í•­ ìƒì„± ìš”ì²­
    ItemFeedbackRequest:
      type: object
      required:
        - request_type
        - learnerID
        - session_id
        - message
        - conversation_history
      properties:
        request_type:
          type: string
          enum: [item_feedback]
          description: ìš”ì²­ íƒ€ì… (ìœ ì‚¬ë¬¸í•­ ìƒì„±)
          example: "item_feedback"
        learnerID:
          type: string
          description: í•™ìŠµì ê³ ìœ  ID
          example: "A070001768"
          pattern: '^[A-Z][0-9]{9}$'
        session_id:
          type: string
          description: ì§„ë‹¨í…ŒìŠ¤íŠ¸ ì„¸ì…˜ ID
          example: "rt-20250918:first6:A070001768:0"
          minLength: 5
          maxLength: 100
        message:
          type: string
          description: í•™ìƒì˜ ìœ ì‚¬ë¬¸í•­ ìš”ì²­ ë©”ì‹œì§€
          example: "1ë²ˆë¬¸ì œ ìœ ì‚¬ ë¬¸í•­ ì£¼ì„¸ìš”"
          minLength: 1
          maxLength: 1000
        conversation_history:
          type: array
          items:
            $ref: '#/components/schemas/ConversationMessage'
          description: ì´ì „ ëŒ€í™” ê¸°ë¡
          minItems: 1
          maxItems: 100

    # 3ë‹¨ê³„: íŒíŠ¸ ì œê³µ ìš”ì²­
    GeneratedItemRequest:
      type: object
      required:
        - request_type
        - generated_question_data
        - message
        - conversation_history
      properties:
        request_type:
          type: string
          enum: [generated_item]
          description: ìš”ì²­ íƒ€ì… (íŒíŠ¸ ì œê³µ)
          example: "generated_item"
        generated_question_data:
          $ref: '#/components/schemas/GeneratedQuestion'
          description: 2ë‹¨ê³„ì—ì„œ ìƒì„±ëœ ë¬¸ì œ ë°ì´í„°
        message:
          type: string
          description: í•™ìƒì˜ ë©”ì‹œì§€ (ì§ˆë¬¸, ë‹µì•ˆ ì‹œë„ ë“±)
          example: "ëª¨ë¥´ê² ì–´ìš”"
          minLength: 1
          maxLength: 1000
        conversation_history:
          type: array
          items:
            $ref: '#/components/schemas/ConversationMessage'
          description: ì´ì „ ëŒ€í™” ê¸°ë¡
          minItems: 1
          maxItems: 100
        learnerID:
          type: string
          description: í•™ìŠµì ê³ ìœ  ID (ê°œì¸í™”ìš©, ì„ íƒì )
          example: "A070001768"
          pattern: '^[A-Z][0-9]{9}$'
        original_concept:
          type: string
          description: ì›ë³¸ ê°œë…ëª… (ê°œì¸í™”ìš©, ì„ íƒì )
          example: "ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´"
          maxLength: 200

    # API ì‘ë‹µ
    TutorAPIResponse:
      type: object
      required:
        - feedback
        - conversation_history
      properties:
        feedback:
          type: string
          description: AI íŠœí„°ì˜ ì‘ë‹µ ë©”ì‹œì§€
          example: "ê°ê¸°ë‘¥ì˜ ê²‰ë„“ì´ë¥¼ êµ¬í•˜ë ¤ë©´ ì–´ë–¤ ë©´ë“¤ì˜ ë„“ì´ë¥¼ ë”í•´ì•¼ í• ê¹Œìš”?"
          minLength: 1
          maxLength: 5000
        conversation_history:
          type: array
          items:
            $ref: '#/components/schemas/ConversationMessage'
          description: ì—…ë°ì´íŠ¸ëœ ëŒ€í™” ê¸°ë¡
          maxItems: 100
        generated_question_data:
          $ref: '#/components/schemas/GeneratedQuestion'
          description: ìƒì„±ëœ ë¬¸ì œ ë°ì´í„° (2ë‹¨ê³„ ì‘ë‹µì—ë§Œ í¬í•¨)

    # ì—ëŸ¬ ì‘ë‹µ
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: ì—ëŸ¬ ë©”ì‹œì§€
          example: "Required fields are missing: learnerID"
          minLength: 1
          maxLength: 1000

  # ë³´ì•ˆ ìŠ¤í‚¤ë§ˆ (í˜„ì¬ëŠ” Function Level Auth ì‚¬ìš©)
  securitySchemes:
    FunctionKey:
      type: apiKey
      in: header
      name: x-functions-key
      description: Azure Functions ì¸ì¦ í‚¤ (ë¡œì»¬ ê°œë°œì‹œ ë¶ˆí•„ìš”)

# ê¸€ë¡œë²Œ ë³´ì•ˆ ì„¤ì • (ìš´ì˜ í™˜ê²½ì—ì„œë§Œ ì ìš©)
security:
  - FunctionKey: []

tags:
  - name: Tutoring
    description: |
      AI íŠœí„°ë§ ê´€ë ¨ ëª¨ë“  ê¸°ëŠ¥

      **3ë‹¨ê³„ í•™ìŠµ í”Œë¡œìš°:**
      1. ì§„ë‹¨í…ŒìŠ¤íŠ¸ ë¶„ì„ â†’ 2. ìœ ì‚¬ë¬¸í•­ ìƒì„± â†’ 3. ì†Œí¬ë¼í‹± íŒíŠ¸

externalDocs:
  description: ê°œë°œ ê°€ì´ë“œ ë° ì˜ˆì œ ì½”ë“œ
  url: /tests/README.md